{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Viability Configuration Schema",
  "description": "Defines the structure for the 'viability' and related sections of the agent's configuration.",
  "type": "object",
  "properties": {
    "constraints": {
      "description": "A list of structured constraint objects defining the viable region.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/constraint"
      },
      "minItems": 1
    },
    "shield": {
      "description": "Configuration for the safety shield.",
      "type": "object",
      "properties": {
        "conf": {
          "description": "Confidence level for the shield's safety projection.",
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "horizon": {
          "description": "The prediction horizon for the shield (in steps).",
          "type": "integer",
          "minimum": 1
        }
      },
      "required": ["conf", "horizon"]
    }
  },
  "required": ["constraints", "shield"],
  "definitions": {
    "constraint": {
      "type": "object",
      "description": "A single safety or viability constraint.",
      "properties": {
        "name": {
          "type": "string",
          "description": "A unique name for the constraint (e.g., 'energy_min')."
        },
        "variable": {
          "type": "string",
          "description": "The internal state variable this constraint applies to (e.g., 'energy', 'temp')."
        },
        "operator": {
          "type": "string",
          "enum": [">=", "<=", "in"],
          "description": "The comparison operator."
        },
        "threshold": {
          "description": "The threshold value or range for the constraint.",
          "oneOf": [
            { "type": "number" },
            {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 2,
              "maxItems": 2
            }
          ]
        },
        "units": {
          "type": "string",
          "description": "The unit of the variable (e.g., 'ratio', 'celsius')."
        },
        "description": {
          "type": "string",
          "description": "A human-readable description of the constraint's purpose."
        },
        "recovery_penalty": {
            "type": "number",
            "description": "Penalty applied when this specific constraint is violated. Overrides default penalties.",
            "minimum": 0
        }
      },
      "required": ["name", "variable", "operator", "threshold", "description"]
    }
  }
}